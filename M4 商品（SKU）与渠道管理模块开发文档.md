# M4 商品（SKU）与渠道管理模块开发文档

> 模块定位：承接“产品”与“渠道”的**销售载体层**（SKU 层）
> 依赖关系：依赖 M3 产品管理模块（仅可绑定“已上架产品”）
> 设计目标：在不破坏产品稳定性的前提下，支撑多渠道、多售卖策略、多上下架节奏

---

## 1. 模块边界与核心职责

### 1.1 模块解决的问题

* 将一个产品包装为一个或多个**商品（SKU）**
* 管理商品在不同渠道的售卖状态与差异化配置
* 承接后续：

  * 定价（M5）
  * 库存（M6）
  * 订单（M7）

### 1.2 模块不解决的问题

* 不负责资源组合（由 M3 决定）
* 不计算最终价格（由 M5 决定）
* 不管理库存数量（由 M6 决定）

> 商品模块回答的问题是：**“同一个产品，在什么渠道，以什么售卖形态存在？”**

---

## 2. 核心概念与设计原则

### 2.1 商品（SKU）

* 定义：产品在某一售卖策略下的实例
* 常见拆分维度：

  * 渠道差异（抖音 / 美团 / 小程序）
  * 日期差异（工作日 / 节假日）
  * 售卖规则差异（直售 / 分销 / 团购）

### 2.2 渠道（Channel）

* 定义：发生销售行为的平台或平台内单元
* 支持层级：

  * 一级：平台（抖音、美团等）
  * 二级：门店 / 账号 / 城市 / 团长

### 2.3 设计原则

1. **SKU 是库存/订单/价格的最小承载单位**
2. 商品生命周期独立于产品
3. 一个 SKU 可被多个渠道引用（N:N）
4. 上下架必须可审计、可回溯

---

## 3. 数据模型设计（PGSQL）

### 3.1 商品表 `sku`

| 字段           | 类型          | 说明                 |
| ------------ | ----------- | ------------------ |
| id           | bigint PK   | SKU ID             |
| product_id   | bigint FK   | 绑定产品               |
| sku_name     | text        | 商品名称（可与产品不同）       |
| sku_type     | text        | 常规 / 节假日 / 特殊策略    |
| sale_start   | date        | 售卖开始日期             |
| sale_end     | date        | 售卖结束日期             |
| travel_start | date        | 出行开始               |
| travel_end   | date        | 出行结束               |
| status       | text        | 草稿 / 待审批 / 上架 / 下架 |
| created_by   | text        | 创建人                |
| created_at   | timestamptz | 创建时间               |
| updated_at   | timestamptz | 更新时间               |

**约束**

* 同一产品下，sku_name 不强制唯一（允许多策略）
* product_id 必须指向 status=上架 的 product

---

### 3.2 渠道表 `channel`

| 字段           | 类型          | 说明           |
| ------------ | ----------- | ------------ |
| id           | bigint PK   | 渠道 ID        |
| channel_name | text        | 渠道名称         |
| channel_type | text        | 平台 / 门店 / 账号 |
| parent_id    | bigint      | 上级渠道         |
| attrs        | jsonb       | 渠道扩展信息       |
| status       | text        | 启用 / 停用      |
| created_at   | timestamptz | 创建时间         |

**示例层级**：

* 抖音（平台）

  * 抖音-上海门店
  * 抖音-杭州门店

---

### 3.3 商品-渠道关系表 `sku_channel`

> 表示：某 SKU 在某渠道“是否可卖”。

| 字段               | 类型          | 说明      |
| ---------------- | ----------- | ------- |
| id               | bigint PK   | 主键      |
| sku_id           | bigint FK   | 商品      |
| channel_id       | bigint FK   | 渠道      |
| channel_sku_code | text        | 渠道侧商品编码 |
| status           | text        | 上架 / 下架 |
| created_at       | timestamptz | 创建时间    |

**约束**

* unique(sku_id, channel_id)

---

### 3.4 SKU 状态历史（可选）`sku_status_history`

| 字段            | 类型          | 说明 |
| ------------- | ----------- | -- |
| id            | bigint PK   |    |
| sku_id        | bigint      |    |
| before_status | text        |    |
| after_status  | text        |    |
| operator      | text        |    |
| operated_at   | timestamptz |    |
| reason        | text        |    |

---

## 4. SKU 生命周期与状态机

### 4.1 状态定义

| 状态  | 含义      |
| --- | ------- |
| 草稿  | 编辑中，不可售 |
| 待审批 | 等待审批    |
| 上架  | 可售      |
| 下架  | 停售      |

---

### 4.2 状态流转

```
草稿 → 待审批 → 上架 → 下架
            ↘ 驳回 → 草稿
```

> SKU 上架/下架通常需要审批（规则在 M8 中统一）。

---

## 5. 关键业务流程

### 5.1 新建 SKU

1. 在产品详情页点击【创建商品】
2. 填写：

   * sku_name
   * 售卖期 / 出行期
   * sku_type
3. 保存为草稿
4. 提交审批

校验规则：

* 售卖期必须覆盖出行期（或至少不冲突）

---

### 5.2 SKU 绑定渠道

1. 进入 SKU 详情页 →【渠道配置】
2. 选择一个或多个渠道
3. 设置渠道侧商品编码（可选）
4. 保存

> 此步骤不等同于“上架”，仅表示可配置。

---

### 5.3 SKU 上架 / 下架

* 上架前校验：

  * SKU 已审批通过
  * 至少绑定一个渠道
  * 已配置价格（M5）
  * 已初始化库存（M6）

* 下架影响：

  * 不可新售
  * 不影响历史订单

---

## 6. 前端页面与交互设计

### 6.1 页面清单

1. SKU 列表页（可按产品查看）
2. SKU 详情页
3. 新建 / 编辑 SKU
4. SKU 渠道配置弹窗

---

### 6.2 SKU 列表页

* 搜索：SKU 名称 / 产品名
* 筛选：状态 / 产品
* 展示：

  * SKU 名称
  * 产品名
  * 售卖期 / 出行期
  * 状态

---

### 6.3 SKU 详情页

Tabs 建议：

* 基础信息
* 渠道配置
* 定价（只读，跳转 M5）
* 库存（只读，跳转 M6）
* 订单（只读，跳转 M7）

---

## 7. 异常与边界场景

1. 产品被下架：

* 其 SKU 不自动下架
* 但禁止新建 SKU

2. 渠道被停用：

* sku_channel.status 强制下架

3. SKU 删除策略：

* 不允许物理删除
* 仅允许下架

---

## 8. 与其他模块的数据契约

| 模块    | 关系                      |
| ----- | ----------------------- |
| M5 定价 | price 以 sku_id 为核心      |
| M6 库存 | inventory 以 sku_id + 日期 |
| M7 订单 | order 必须关联 sku_id       |
| M8 审批 | SKU 上下架、关键变更走审批         |

---

## 9. 可扩展方向（不影响一期）

* 渠道专属 SKU（1 SKU = 1 渠道）模式
* 渠道属性映射（类目、标签）
* 分销 / 团购 / 达人 SKU

---

> 设计总结：SKU 模块的本质是“**变化的缓冲层**”，所有渠道差异、售卖策略，都应该在这一层解决，而不是污染产品结构。
